# AirRadar 项目报告（AI Ethics 导向）

项目简介（Demo）：本 Demo 以 AirRadar 为技术基线，面向真实北京小时级空气数据，打通“数据构建→一致性校验→训练评估→可视化→伦理摘要”的端到端闭环。模型融合局部方向先验与频域全局表征，支持动态节点数与缺测掩码，并内建可复现的数据规范与图像化输出，侧重公平性、透明性与能耗感知等工程伦理要素，便于在城市治理与教学科研中快速验证与迭代。

---

## 一、研究背景与需求分析

### 1.1 问题描述

空气污染具有显著的时空异质性，监测点稠密与稀疏区域差异显著，传统插值方法难以同时兼顾细节与全局依赖。公开数据往往存在缺测、异构与口径差异，容易导致模型性能不稳定与结果不可比；工程落地也常忽视伦理与可持续性，对弱覆盖地区的公平性、透明度与能耗缺乏度量，这些问题共同制约了面向公共治理的可信应用。

### 1.2 项目目标

本项目的目标是在不依赖重型外部库的前提下，构建一个工程伦理导向的可运行 Demo：以北京近年小时级数据为例，打通从数据构建到结果呈现的全流程；在模型侧提供动态节点支撑、缺测掩码鲁棒性与频域全局建模并融合方向先验；在工程侧建立标准化数据规范与一致性校验，配套可视化出口以支撑分析、汇报与审计追踪。

### 1.3 同类产品（工作）比较

传统数值模式（CTM）具有较强的物理一致性，但计算成本高且难以高频更新；经典统计与地学插值（如 Kriging）解释性出色，却难以捕捉强非线性与复杂时序依赖；端到端深度时空模型（GNN/Transformer）表达力强，但过拟合、可解释性与能耗问题备受关注。综合权衡后，我们选择“方向扇区先验 + 频域 AFNO”的折中方案，力求在效率、全局性与可扩展性之间取得平衡，并内置必要的伦理度量。

### 1.4 市场（需求）调研

围绕公众与弱势群体、政府监管部门以及科研与企业用户，需求集中在细粒度时空补全与预估、缺测场景下的鲁棒性、结果的可解释与可审计，以及训练与推理成本的可控与部署的简洁。对于高不确定性区域，还需要明确的风险提示与责任边界说明，以便在实际应用中安全、透明且可追溯。

---

## 二、技术方案

### 2.1 方案提出与选型

技术路线对比包含四类思路：基于图的时空网络（ST-GNN）、纯注意力 Transformer、频域网络（AFNO/FNO）以及统计插值加机器学习后处理。前两者在全局建模和表达力方面占优，但复杂度与能耗较高；后两者工程复杂或难以统一流程。综合模型能力、计算复杂度与可移植性，我们确定以“局部方向扇区注意力（DS-MSA）+ 频域 AFNO（FftNet）+ MoE 输出头”为核心架构，并辅以掩码学习与动态节点位置编码，以满足鲁棒性与跨区域迁移的需求。

### 2.2 概要设计

系统自底向上由数据层、模型层、训练层与可视化/伦理工具四部分构成：数据层通过构建脚本将日 CSV（包含 date、hour、type 与站点列）聚合为标准化的 npz/npy 数据，并由一致性校验器按模式文件检查文件、形状与取值范围；模型层以 AirEmbedding 处理风向、天气、小时与星期等类别特征并做越界保护，采用掩码一致性机制统一训练与评估的数据分布，利用 Temporal 聚合与 Spatial（DS-MSA + FftNet）双分支融合，再以动态位置编码与 MoE 输出适配不同节点规模与区域异质性；训练层统一接口与早停策略，记录损失与指标，便于复现与分析；可视化与伦理工具提供训练曲线、时间序列和空间热力图，以及能耗估计与频域概览，支撑解释、汇报与治理。

### 2.3 详细设计与关键改进

在详细设计中，首先确保掩码一致性，在训练与评估阶段对输入与历史数据同步施加掩码以保证分布一致；其次以 schema 与 validator 建立数据治理基线，降低因数据质量差异引发的性能漂移并强化可审计性；再次，引入空间渐变热力图与时间序列的幅度对齐与平滑选项，帮助识别相位与幅度层面的误差特征，这些处理仅用于可视化展示，不影响指标评估，从而在保证严谨性的同时提升分析效率。

### 2.4 可替代实现与折中

替代路径主要包括三类：一是转向纯 Transformer 以提升端到端全局建模能力，但需要付出更高的计算成本与解释难度；二是与数值模式深度融合以增强物理一致性，例如引入物理引导损失或资料同化，但工程复杂度显著上升；三是在边缘部署场景下进行模型蒸馏或裁剪，以牺牲部分精度换取能效与时延优势。最终采用何种折中取决于业务目标、资源约束与合规要求。

---

## 三、实施计划

### 3.1 人员与组织

团队在初期建议由五人构成，分别覆盖架构与算法设计、数据工程（含 ETL 与校验器）、训练与 MLOps（含脚本、配置与复现）、可视化与前端（曲线、热力图与报告导出）以及伦理与合规（公平性切片、能耗审计与风控）等关键角色；若进入规模化阶段，可按实际需要补充后端/前端工程师、GIS 专家与运维支持，以保障系统演进与稳定运营。

### 3.2 资源预算（示例）

资源方面，单机 GPU 或 CPU 即可运行 Demo，正式训练建议使用 1×A100 或 2×3090，并按云上资源估算每月约 5–10k RMB 的开销（可按需缩放）。数据来源以公开监测数据及其元数据（经纬度与站点信息）为主，配套建设日志与指标存储体系并生成可视化报告，以便分析、排障与审计。

### 3.3 时间计划（12–16 周建议）

整体进度可分为四个阶段：前两周用于需求确认、数据摸底与指标定义并完成伦理基线划分；第三至第六周聚焦数据构建与校验器、模型主干实现以及端到端闭环与可视化贯通；第七至第十周进行评估与调参，并替换真实经纬度与更合理的图/分区，同时接入伦理度量；第十一至第十二周完成报告撰写、自动化脚本与演示页面沉淀并预演汇报；第十三至第十六周为可选阶段，针对蒸馏与不确定性评估、部署脚本以及外部数据源/前端对接开展迭代。

---

## 四、非技术要素分析

### 4.1 创新设计

本方案的创新点体现在结构与工程两端：在结构上以“方向扇区先验 + 频域全局”实现空间方向性与长距离依赖的兼顾；在工程上以 schema、validator 与可视化出口形成标准化流程，显著缩短沟通与调试链路；同时将能耗估计、公平性切片与可解释占位内置于工作流之中，便于尽早暴露潜在风险并为治理提供依据。

### 4.2 知识产权与许可

系统主要基于公开研究实现，并去除了对 timm 等外部库的耦合依赖，保留了自研的 DropPath、动态位置编码与数据校验器等拼装部分。部署阶段需对第三方库的许可证进行合规审查；若引入可能涉及专利的方法，应同步评估潜在侵权风险并预备可替代技术路径。

### 4.3 环境关切（绿色 AI）

在绿色 AI 方面，当前以样本数、训练轮次与设备系数进行能耗粗估，后续建议在正式训练中接入 profiler 与碳排放估算工具以获得更准确的度量；降碳实践可以通过混合精度训练、频域系数剪枝、模型蒸馏与异步推理等手段落地，以在性能与能效之间取得更优平衡。

### 4.4 工程伦理（公平/透明/责任）

工程伦理层面强调三类能力：其一是公平性，通过区域、站点密度与风向切片报告差异化指标，并在必要时对低密度区域进行重加权或发布置信提示；其二是透明性，要求版本化配置、数据口径披露与频域/注意力概览以便外部审阅；其三是责任边界，明确输出用于趋势感知与补全而非替代合规监测，并在高不确定场景中提示风险且引入“人在回路”。

### 4.5 工程经济成本

从经济成本看，频域全局建模的复杂度较低，整体成本可控；可根据资源条件进行参数压缩与数据裁剪以进一步优化费用。同时，前期在文档化、标准化与自动化工具上的投入能够显著降低长期维护成本，提高迭代效率与可持续性。

### 4.6 风险分析与应对

风险主要来源于数据、模型与运营三个层面：数据方面需针对缺失与异常引入前向填充、插值、异常检测与显著性过滤；模型方面通过早停、正则、再训练与数据再抽样对抗过拟合与概念漂移，并结合置信区间发布提升稳健性；运营方面则需以接口与文档明确使用边界，配套审计追踪与撤回机制以防止误用与滥用。

### 4.7 推广与应用计划

在推广与应用上，教学与科研场景可以依托可运行脚本、可视化成果与伦理摘要实现课堂与研讨的快速复现；城市治理场景可采用“试点城市—指标对齐—风险标签”的路径逐步推广，并与本地数值模式与站点数据融合以形成更强的业务闭环。

---

## 五、总结

本 Demo 以面向伦理的工程化思路，构建了从“真实数据→校验→训练→图像化→伦理摘要”的最小闭环，提供了可迁移、可复现与可审计的实践样例。通过“方向扇区先验 + 频域 AFNO”的结构折中与动态节点/缺测鲁棒增强，兼顾效率与全局性；借助标准化数据规范与可视化工具，显著降低协作与复现门槛。后续将围绕公平性正式评估、绿色训练与多污染物多任务拓展，推动在真实治理场景中的稳健落地。

## 1. 选题背景

空气污染对公共健康、经济发展和城市治理具有重大影响。传统监测网络点位有限，难以覆盖大范围与复杂地形。AirRadar 旨在利用深度学习在全国尺度对空气质量（以 PM2.5 为主）进行插值与推断，辅助政府与公众更及时地感知空气质量变化。本学期重点强调人工智能伦理（AI Ethics），因此我们在技术方案之上，重点讨论模型在公平性、透明性、可持续性与隐私保护等方面的工程问题与治理思路。

## 2. 需求调研

- 利益相关方：
  - 公众与弱势群体（对空气质量变化更加敏感，需要公平覆盖与可信结果）
  - 政府监管与决策部门（要求模型可靠、可解释并具备可审计性）
  - 科研与企业机构（关注成本、性能、复现性、可扩展性与合规）
- 功能需求：
  - 大范围、细粒度空气质量估计（PM2.5/PM10/NO2/…）
  - 支持缺测情况下的稳健推断与不确定性提示
  - 结果可溯源、可解释，便于与传统数值模式和专家知识融合
  - 可持续运行：训练推理成本可控、适配边缘/低碳算力
- 非功能需求（伦理与治理）：
  - 公平性：对监测点稀疏、欠发达地区不应系统性劣化
  - 透明性：关键设计公开、评估指标清晰、数据与模型局限性披露
  - 责任与安全：避免滥用、误用与“虚假确定性”带来的风险
  - 隐私与合规：遵循数据使用边界与合规（即使本项目主要使用公开环境数据，也需注意地理位置信息的再识别风险）

## 3. 技术方案（简述）

- 模型结构：
  - 局部空间注意力（DS-MSA + dartboard 扇区划分）融合地理方向性先验
  - 频域全局建模（AFNO/FftNet）降低复杂度同时捕获长距离依赖
  - 类别特征嵌入（天气、风向、时间因子）增强时空模式表达
  - 专家混合（MoE）输出头应对区域/条件异质性
- 训练评测：
  - 基于掩码学习（mask token）模拟缺测场景
  - 使用 masked MAE/RMSE/MAPE 指标，仅在有效位置评估
- 本报告中的优化方向：
  - 工程可移植性：去除节点数与 GPU 的硬编码、统一接口
  - 伦理工具链：增加公平性分析、可解释性占位、能耗估算
  - Demo：提供最小可运行示例与伦理评估示范

## 4. 项目创新点

- 结构先验 + 频域全局：将 dartboard 方向先验与 AFNO 频域滤波结合，兼顾局部细节与全球依赖。
- 缺测鲁棒：训练-评测一致的掩码范式，提高缺测下的稳健性。
- 工程化改造：动态节点数的 pos embedding 与 AFNO 频率分辨率自适应，减少对特定数据集的耦合。
- 伦理加持：在训练与发布流程中引入公平性诊断与能耗度量，形成“性能-伦理-成本”的三维权衡框架。

## 5. 经济成本分析

- 算力成本：
  - 频域模块在捕获全局依赖的同时显著降低自注意力 O(N^2) 的开销；但 pos_embed/FFT 仍需要显存与时间。
  - 通过小批量/混合精度与裁剪频率模式可进一步降低成本。
- 开发运维成本：
  - 标准化的训练器接口、配置化与自动化脚本能减少维护成本。
- 机会成本：
  - 可解释性/公平性评估会引入额外的开发时间，但有助于降低下游决策风险与合规成本。

## 6. 工程与伦理

- 公平性：
  - 问题：监测点稠密地区（大城市）易获得更低误差，欠发达区域系统性偏差风险更高。
  - 方案：按区域/密度分层报告指标；对低密度区域采用重加权训练或不确定性阈值提示；在产品侧对高不确定性区域突出“需谨慎解读”。
- 透明性与可解释：
  - 提供重要特征/扇区注意力可视化与频域能量分布摘要；记录数据版本、模型版本与训练配置。
- 能源与环境：
  - 引入能耗估计（如碳排放估算）与“绿色预算”，对大规模训练设定配额；鼓励蒸馏与边缘推理。
- 安全与责任：
  - 限制模型输出用于“趋势感知与补全”，不直接替代合规监测；发布置信区间或风险标签，避免过度信赖。

## 7. 工程风险与权衡

- 性能 vs 公平：在低密度区域做重加权可能牺牲总体 MAE，需要平衡整体与边缘群体的误差。
- 精度 vs 成本：更深的频域网络提高准确率但增加训练成本；可通过早停、剪枝与蒸馏折中。
- 复杂度 vs 透明性：模型越复杂越难解释；可在发布环境使用蒸馏的小模型并配套可解释模块。

## 8. 优化设计（本次提供的 Demo）

- 工程改造：
  - 动态节点 pos_embed 与 AFNO 频率维度自适应
  - 统一模型 forward(inputs, history, mask_nodes=None, pred_attr="PM25", g=None)
  - Trainer+：设备自适应、日志钩子、统一掩码处理
- 伦理工具：
  - 公平性切片评估（按地区/节点密度）
  - 能耗粗估计（样本数×epoch×设备系数）
  - 可解释性占位（注意力/频域能量导出接口）

## 9. Demo 使用说明（简述）

- 目录：optimized_demo/
  - model/airRadar_plus.py：改造后的模型
  - utils/trainer_plus.py：统一 Trainer
  - ethics/evaluation.py：伦理评估工具
  - configs/config.yaml：示例配置
  - train.py：训练脚本（最小批次）
  - run_demo.py：一键演示（若数据与依赖就绪）

## 10. 结论与展望

AirRadar 将结构先验与频域建模结合，适合全国尺度空气质量估计。本报告围绕 AI 伦理进行了系统性分析，并通过工程化改造与 Demo 展示了“性能-成本-伦理”的综合权衡实践。后续可拓展多污染物多任务学习、引入不确定性估计与可视化、推进绿色 AI 训练与部署策略。

## 11. 数据与评估（北京数据 Demo 实证）

本次 Demo 基于真实北京近一年小时级数据进行了端到端评估，重点验证“数据→校验→训练→伦理摘要”的可运行闭环。

### 11.1 数据与预处理

原始数据以按日划分的 CSV 文件提供，列包含日期、小时、指标类型与站点值，其中类型覆盖 1 小时量（PM2.5、PM10、NO2、CO、O3、SO2、AQI）与 24 小时量（如 PM2.5_24h 等）。我们使用构建脚本将其聚合为标准化数据集，产物包含训练/验证/测试样本与对应历史窗口、站点坐标与节点划分等，并在输入维度、输出维度与序列长度上采用统一设定。缺失值在构建阶段先以零占位，后续建议采用前向填充或插值替换。数据一致性由校验工具按 schema 文件进行文件完整性、形状与取值范围检查，本次在 35 节点规模下通过了校验。

### 11.2 训练与指标（CPU 环境）

训练与评估通过一键脚本完成，主要配置包含训练轮次、批大小与目标指标等。本次运行结果显示验证集 MAE 与 RMSE 在有限轮数内取得明显下降，测试集也给出了可参考的误差水平；同时，伦理占位摘要给出相对量纲的能耗估计与频域能量切片分布，用于观察训练过程的资源消耗趋势与频谱特征，便于在性能、能耗与过拟合风险之间进行权衡。

说明：由于本次 pos.npy 与图/扇区为占位构造，误差绝对数值主要用于验证工程闭环与相对趋势对比；更合理的地理先验（真实经纬度、基于距离构图与分区）将显著影响指标。

### 11.3 工程稳健性修复（与伦理关联）

在工程稳健性方面，我们修复了分类嵌入越界问题：通过在嵌入层与前处理阶段统一对小时与星期等离散索引进行范围裁剪，并与输入顺序显式对齐，避免因偶发错误造成的运行中断与不可解释输出；同时在标准化环节为零方差通道引入极小量保护以避免除零，减少异常传播导致的指标失真。这些修复与伦理目标一致，提升了公平、透明与可复现的基础。

## 12. 数据治理与合规

### 12.1 数据标准与可追溯

数据标准与可追溯性通过“机器可读的 schema 与人类可读的设计规范”双轨保障：前者定义文件与数组的结构与范围，后者说明使用约束与字段语义；一致性校验器按 schema 自动检查结构、范围与图分区；训练与评估配置则建议以文件化与版本化方式保存随机种子、参数与权重，以方便复现与审计。

### 12.2 缺失值与异常值策略

在当前实现中，构建阶段以零占位处理缺失，便于快速贯通流程；正式使用时建议对小时级连续缺失采用前向填充或线性插值，对跨日或节假日造成的断点进行分段插值并标注不确定性；对于 24 小时滚动指标，若缺失率较高可在训练阶段降低其损失权重或拆分为独立任务；在前端呈现时，应对高缺失片区附上“低置信度”提示，以降低误导风险。

### 12.3 地理先验与公平

目前的站点坐标与图/分区为占位构造，主要用于验证闭环；在真实部署中，应使用站点经纬度重建坐标，基于球面距离或道路网络构建邻接图，并据此生成更符合地理规律的扇区划分；同时按区域、站点密度与下风/上风等准则切片评估误差，避免城市与郊区间出现系统性偏差。

## 13. 风险控制与发布策略

发布策略需同时覆盖风险提示、人在回路、滥用防护与复现审计：在低密度、缺失严重或极端气象场景下，应在前端显著标注高不确定性并辅以置信区间；模型定位为决策辅助而非合规替代，重要场景引入专家审核；文档与接口需明确适用边界并禁止将输出用于执法或医疗处置；同时固定随机种子、记录数据与模型版本并导出训练日志与评估报告，以满足内外部审计要求。

## 附录：快速复现清单（可选）

本附录面向教学与研发场景提供快速复现路径，生产环境需结合本地运维规范与数据授权执行：首先使用构建脚本将原始 CSV 转为标准数据集，其后通过数据校验器对照 schema 进行一致性检测；随后使用一键脚本完成训练与评估，参数由配置文件统一管理；最后调用伦理评估模块生成能耗与频域等摘要指标，正式部署时可替换为更完整的公平性与可解释性组件。
